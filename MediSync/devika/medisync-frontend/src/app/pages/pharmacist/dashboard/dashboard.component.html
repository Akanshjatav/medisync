<div class="container page-head">
  <div class="breadcrumbs">PHARMACIST / DASHBOARD</div>
  <div class="head-row">
    <div class="branch">Dashboard Overview</div>
    <div class="tools">
      <button class="btn ghost" (click)="retry()" [disabled]="loading">
        {{ loading ? 'Loading...' : 'Refresh' }}
      </button>
    </div>
  </div>
</div>

<!-- Loading State -->
<div *ngIf="loading" class="loading">
  Loading dashboard data...
</div>

<!-- Error State -->
<div *ngIf="error && !loading" class="error">
  {{ error }}
  <button class="btn" (click)="retry()" style="margin-left: 12px;">Retry</button>
</div>

<!-- Dashboard Content -->
<div *ngIf="!loading && !error && metrics">
  <!-- Metrics Cards -->
  <div class="metrics-grid">
    <div class="metric-card">
      <div class="metric-icon" style="background: linear-gradient(135deg, var(--blue), var(--blue-soft));">
        <span style="font-size: 28px;">üì¶</span>
      </div>
      <div class="metric-content">
        <div class="metric-value">{{ metrics.totalProducts }}</div>
        <div class="metric-label">Total Products</div>
        <div class="metric-sub">{{ metrics.totalQuantity }} units in stock</div>
      </div>
    </div>

    <div class="metric-card">
      <div class="metric-icon" style="background: linear-gradient(135deg, var(--amber), #FFB74D);">
        <span style="font-size: 28px;">‚ö†Ô∏è</span>
      </div>
      <div class="metric-content">
        <div class="metric-value">{{ metrics.lowStockCount }}</div>
        <div class="metric-label">Low Stock Items</div>
        <div class="metric-sub">Requires attention</div>
      </div>
    </div>

    <div class="metric-card">
      <div class="metric-icon" style="background: linear-gradient(135deg, var(--red), #EF5350);">
        <span style="font-size: 28px;">‚è∞</span>
      </div>
      <div class="metric-content">
        <div class="metric-value">{{ metrics.expiringCount }}</div>
        <div class="metric-label">Expiring Soon</div>
        <div class="metric-sub">Within 30 days</div>
      </div>
    </div>

    <div class="metric-card">
      <div class="metric-icon" style="background: linear-gradient(135deg, var(--green), var(--green-light));">
        <span style="font-size: 28px;">üìã</span>
      </div>
      <div class="metric-content">
        <div class="metric-value">{{ metrics.pendingRfsCount }}</div>
        <div class="metric-label">Pending RFS</div>
        <div class="metric-sub">Awaiting approval</div>
      </div>
    </div>
  </div>

  <!-- Main Content Grid -->
  <div class="dashboard-grid">
    <!-- Expiry Alerts -->
    <div class="card">
      <div class="card-header">
        <span>‚è∞ Expiry Alerts</span>
        <a routerLink="/pharmacist/expiry" class="btn ghost">View All</a>
      </div>
      
      <div *ngIf="expiryAlerts.length === 0" class="empty">
        No medicines expiring within 30 days
      </div>

      <table *ngIf="expiryAlerts.length > 0" class="inventory-table">
        <thead>
          <tr>
            <th>Product Name</th>
            <th>Category</th>
            <th>Quantity</th>
            <th>Expiry Date</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let alert of expiryAlerts.slice(0, 5)">
            <td><strong>{{ alert.productName }}</strong></td>
            <td>{{ alert.category }}</td>
            <td class="qty">{{ alert.quantity }}</td>
            <td>{{ formatDate(alert.expiryDate) }}</td>
            <td>
              <span class="status-chip" [ngClass]="getExpiryStatusClass(alert.daysUntilExpiry)">
                <span class="dot"></span>
                {{ alert.daysUntilExpiry }} days
              </span>
            </td>
          </tr>
        </tbody>
      </table>

      <div *ngIf="expiryAlerts.length > 5" style="padding: 12px; text-align: center; border-top: 1px solid var(--border);">
        <a routerLink="/pharmacist/expiry" style="font-weight: 700; color: var(--blue);">
          View {{ expiryAlerts.length - 5 }} more ‚Üí
        </a>
      </div>
    </div>

    <!-- Low Stock Items -->
    <div class="card">
      <div class="card-header">
        <span>‚ö†Ô∏è Low Stock Items</span>
        <a routerLink="/pharmacist/inventory" class="btn ghost">View Inventory</a>
      </div>

      <div *ngIf="lowStockItems.length === 0" class="empty">
        All products are adequately stocked
      </div>

      <table *ngIf="lowStockItems.length > 0" class="inventory-table">
        <thead>
          <tr>
            <th>Product Name</th>
            <th>Category</th>
            <th>Current Stock</th>
            <th>Batch ID</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of lowStockItems.slice(0, 5)">
            <td><strong>{{ item.productName }}</strong></td>
            <td>{{ item.category }}</td>
            <td>
              <span class="qty" style="color: var(--amber);">
                {{ item.quantity }}
              </span>
            </td>
            <td>#{{ item.batchId }}</td>
          </tr>
        </tbody>
      </table>

      <div *ngIf="lowStockItems.length > 5" style="padding: 12px; text-align: center; border-top: 1px solid var(--border);">
        <a routerLink="/pharmacist/inventory" style="font-weight: 700; color: var(--blue);">
          View {{ lowStockItems.length - 5 }} more ‚Üí
        </a>
      </div>
    </div>

    <!-- Pending Stock Requests -->
    <div class="card">
      <div class="card-header">
        <span>üìã Pending Stock Requests</span>
      </div>

      <div *ngIf="pendingRfs.length === 0" class="empty">
        No pending stock requests
      </div>

      <table *ngIf="pendingRfs.length > 0" class="inventory-table">
        <thead>
          <tr>
            <th>Request ID</th>
            <th>Store ID</th>
            <th>Items</th>
            <th>Created Date</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let rfs of pendingRfs.slice(0, 5)">
            <td><strong>#{{ rfs.stockRequestId }}</strong></td>
            <td>Store {{ rfs.storeId }}</td>
            <td>{{ rfs.items.length }} items</td>
            <td>{{ formatDate(rfs.createdAt) }}</td>
            <td>
              <span class="status-chip near">
                <span class="dot"></span>
                {{ rfs.status }}
              </span>
            </td>
          </tr>
        </tbody>
      </table>

      <div *ngIf="pendingRfs.length > 5" style="padding: 12px; text-align: center; border-top: 1px solid var(--border);">
        <span style="font-weight: 700; color: var(--muted);">
          {{ pendingRfs.length - 5 }} more pending requests
        </span>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="card">
      <div class="card-header">
        <span>üöÄ Quick Actions</span>
      </div>

      <div class="quick-actions">
        <a routerLink="/pharmacist/dispensing" class="action-btn">
          <div class="action-icon" style="background: rgba(51, 122, 183, 0.12);">üíä</div>
          <div class="action-content">
            <div class="action-title">Dispense Medicine</div>
            <div class="action-desc">Record dispensing activity</div>
          </div>
        </a>

        <a routerLink="/pharmacist/inventory" class="action-btn">
          <div class="action-icon" style="background: rgba(92, 184, 92, 0.12);">üì¶</div>
          <div class="action-content">
            <div class="action-title">View Inventory</div>
            <div class="action-desc">Browse all products</div>
          </div>
        </a>

        <a routerLink="/pharmacist/expiry" class="action-btn">
          <div class="action-icon" style="background: rgba(217, 83, 79, 0.12);">‚è∞</div>
          <div class="action-content">
            <div class="action-title">Expiry Management</div>
            <div class="action-desc">Check expiring medicines</div>
          </div>
        </a>
      </div>
    </div>
  </div>
</div>
