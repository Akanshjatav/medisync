<!-- rfq-create.component.html -->
<div class="page-full">
  <main class="page-content">
    <h1 style="color:#337AB7; margin:0 0 16px;">Create RFQ</h1>

    <form
      [formGroup]="form"
      (ngSubmit)="onSubmit()"
      novalidate
      style="background:#fff;border:1px solid rgba(16,50,74,0.14);border-radius:12px;padding:20px;box-shadow:0 8px 24px rgba(17,17,17,.08);"
    >
      <div style="display:flex;align-items:baseline;justify-content:space-between;gap:12px;margin-bottom:10px;">
        <h2 style="color:#5CB85C; font-size:1.2rem; margin:0; font-weight:800;">RFQ Details</h2>
        <p style="margin:0;color:#c0392b;font-weight:600;font-size:.9rem;">* indicates required</p>
      </div>

      <div formGroupName="rfq">
        <input type="hidden" formControlName="createdBy" />
        
        <input type="hidden" formControlName="statusAward" />
        
        <div class="form-hint" *ngIf="rfqGroup.get('statusAward')?.touched && rfqGroup.get('statusAward')?.hasError('required')">
          Status is required.
        </div>

        <label for="submissionDeadline" style="display:block;font-weight:600;margin:8px 0 6px;">
          Submission Deadline<span style="color:#c0392b;margin-left:4px;">*</span>
        </label>
        <input id="submissionDeadline" type="date" formControlName="submissionDeadline" [attr.min]="todayStr"
               style="width:100%;padding:10px 12px;border:1px solid #515151;border-radius:8px;font-size:14px;background:#fff;" />
        <div class="form-hint" *ngIf="rfqGroup.get('submissionDeadline')?.touched && rfqGroup.get('submissionDeadline')?.hasError('required')">
          Submission Deadline is required.
        </div>
        <div class="form-hint" *ngIf="rfqGroup.get('submissionDeadline')?.touched && rfqGroup.get('submissionDeadline')?.hasError('pastDate')">
          Submission Deadline cannot be in the past.
        </div>

        <label for="expectedDeliveryDate" style="display:block;font-weight:600;margin:8px 0 6px;">
          Expected Delivery Date<span style="color:#c0392b;margin-left:4px;">*</span>
        </label>
        <input id="expectedDeliveryDate" type="date" formControlName="expectedDeliveryDate" [attr.min]="todayStr"
               style="width:100%;padding:10px 12px;border:1px solid #515151;border-radius:8px;font-size:14px;background:#fff;" />
        <div class="form-hint" *ngIf="rfqGroup.get('expectedDeliveryDate')?.touched && rfqGroup.get('expectedDeliveryDate')?.hasError('required')">
          Expected Delivery Date is required.
        </div>
        <div class="form-hint" *ngIf="rfqGroup.get('expectedDeliveryDate')?.touched && rfqGroup.get('expectedDeliveryDate')?.hasError('pastDate')">
          Expected Delivery Date cannot be in the past.
        </div>
      </div>

      <h2 style="color:#5CB85C; font-size:1.2rem; margin:18px 0 6px; font-weight:800;">Items</h2>

      <div formArrayName="items">
        <div *ngFor="let it of items.controls; let i = index; trackBy: trackByIndex"
             [formGroupName]="i"
             style="border:1px solid #515151;border-radius:10px;padding:14px;margin:12px 0;background:#EAF3FA;">
          <label [attr.for]="'name-'+i" style="display:block;font-weight:600;margin:8px 0 6px;">
            Item Name<span style="color:#c0392b;margin-left:4px;">*</span>
          </label>
          <input [id]="'name-'+i" type="text" formControlName="rfqItemName"
                 placeholder="e.g., Paracetamol 500mg"
                 style="width:100%;padding:10px 12px;border:1px solid #515151;border-radius:8px;font-size:14px;background:#fff;" />
          <div class="form-hint" *ngIf="it.get('rfqItemName')?.touched && (it.get('rfqItemName')?.hasError('required') || it.get('rfqItemName')?.hasError('minlength'))">
            Item Name is required (min 2 characters).
          </div>

          <label [attr.for]="'qty-'+i" style="display:block;font-weight:600;margin:12px 0 6px;">
            Quantity Needed<span style="color:#c0392b;margin-left:4px;">*</span>
          </label>
          <input [id]="'qty-'+i" type="number" formControlName="quantityNeeded" min="1"
                 placeholder="Enter quantity (e.g., 100)"
                 style="width:100%;padding:10px 12px;border:1px solid #515151;border-radius:8px;font-size:14px;background:#fff;" />
          <div class="form-hint" *ngIf="it.get('quantityNeeded')?.touched && (it.get('quantityNeeded')?.hasError('required') || it.get('quantityNeeded')?.hasError('min'))">
            Quantity must be at least 1.
          </div>

          <div style="display:flex;gap:10px;margin-top:12px;flex-wrap:wrap;">
            <button type="button" (click)="removeItem(i)" *ngIf="items.length > 1"
                    style="border:0;cursor:pointer;padding:11px 12px;border-radius:14px;background:#D9534F;color:#fff;font-weight:700;">
              Remove Item
            </button>
          </div>
        </div>
      </div>

      <div style="display:flex;gap:10px;margin-top:12px;flex-wrap:wrap;">
        <button type="button" (click)="addItem()"
                style="border:0;cursor:pointer;padding:11px 12px;border-radius:14px;background:#5CB85C;color:#fff;font-weight:700;">
          Add Another Item
        </button>
        <button type="submit"
                style="border:0;cursor:pointer;padding:11px 12px;border-radius:14px;background:#337AB7;color:#fff;font-weight:700;">
          Submit RFQ
        </button>
      </div>

      <div [style.display]="showErrorBox ? 'block' : 'none'" style="margin-top:10px;">
        <div style="color:#c0392b;font-size:.95rem;">{{ errorBoxMessage }}</div>
      </div>
    </form>
  </main>

  

  <!-- Success Popup -->
  <div *ngIf="showSuccess"
       style="position: fixed; inset: 0; z-index: 1000; display: grid; place-items: center;"
       aria-hidden="true" (click)="closeSuccess()">
    <div style="position:absolute; inset:0; background: rgba(17,17,17,.38); backdrop-filter: blur(2px);"></div>
    <div style="position: relative; width: min(520px, 92vw); background: #ffffff; border-radius: 16px;
                border: 1px solid rgba(16, 50, 74, 0.14); box-shadow: 0 18px 50px rgba(17,17,17,.25);
                padding: 32px 20px 20px; text-align: center;"
         role="dialog" aria-modal="true" aria-label="RFQ submitted successfully" (click)="$event.stopPropagation()">
      <div style="position:absolute; left:50%; top:0; transform: translate(-50%, -50%); width: 78px; height:78px;
                  border-radius: 999px; background: #34C759; display:grid; place-items:center;
                  box-shadow: 0 6px 18px rgba(52,199,89,.45), 0 0 0 6px rgba(52,199,89,.15);" aria-hidden="true">
        <svg width="38" height="38" viewBox="0 0 24 24">
          <path d="M20 6L9 17l-5-5" fill="none" stroke="#fff" stroke-width="2.6" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <h3 style="margin: 28px 0 6px; font-size: 1.35rem; color:#10324A; letter-spacing:.2px;">Thank You!</h3>
      <p style="margin:0 0 18px; color:#515151;">RFQ submitted successfully.</p>
      <div style="display:flex; justify-content:center;">
        <button type="button" (click)="closeSuccess()"
                style="border:0; cursor:pointer; padding:12px 18px; border-radius: 12px; background:#34C759;
                       color:#fff; font-weight:800; letter-spacing:.2px; min-width: 120px; box-shadow: 0 8px 20px rgba(52,199,89,.35);">
          OK
        </button>
      </div>
    </div>
  </div>
</div>