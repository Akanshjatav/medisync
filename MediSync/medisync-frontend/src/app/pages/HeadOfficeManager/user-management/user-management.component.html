<a class="skip-link" href="#main">Skip to content</a>

<div class="app">
  <!-- Navbar
  <header class="navbar" role="banner" aria-label="Navbar">
    <div class="nav-left">
      <button
        class="hamburger"
        id="sidebarToggle"
        type="button"
        aria-label="Toggle sidebar"
        aria-expanded="false"
        aria-controls="sidebar"
      >
        ☰ <span style="font-weight: 900;">Menu</span>
      </button> -->

      <!-- <div class="brand" aria-label="Brand">
        <div class="logo" aria-hidden="true"></div>
        <div class="brand-title">
          <strong>MediSync</strong><br />
        </div>
      </div>
    </div>

    <div class="nav-right" aria-label="Account and status">
      <span class="pill" title="System status">
        <span class="dot" aria-hidden="true"></span>
        Online
      </span>

      <a class="btn ghost" href="../Common Features/login.html">Logout</a>
    </div>
  </header> -->

  <div class="backdrop" id="backdrop" aria-hidden="true"></div>

  <!-- Main -->
  <main class="main" id="main" tabindex="-1">
    <div class="page-title">
      <div>
        <h2>Add User</h2>
        <span class="hint"><span class="req">*</span> Required fields</span>
      </div>
    </div>

    <!-- Card: Add User -->
    <section class="card" aria-label="Add user form">
      <h3>Add / Update User</h3>

      <form [formGroup]="form" (ngSubmit)="onSubmit($event)" novalidate>

        <!-- Messages -->
        <div *ngIf="errorMessage" style="color:#b00020; margin-bottom:10px;">
          {{ errorMessage }}
        </div>

        <!-- ✅ 2-column grid -->
        <div class="um-form-fields">

          <!-- Name -->
          <div class="field-wrap">
            <label class="label">Name <span class="req">*</span></label>
            <input class="input" type="text" formControlName="name" placeholder="Enter name" />
            <div class="help" *ngIf="hasError('name','required')">Name is required</div>
            <div class="help" *ngIf="hasError('name','minlength')">Name must be at least 2 characters</div>
            <div class="help" *ngIf="hasError('name','maxlength')">Name must be less than 50 characters</div>
          </div>

          <!-- Email -->
          <div class="field-wrap">
            <label class="label">Email <span class="req">*</span></label>
            <input class="input" type="email" formControlName="email" placeholder="Enter email" />
            <div class="help" *ngIf="hasError('email','required')">Email is required</div>
            <div class="help" *ngIf="hasError('email','email')">Enter a valid email</div>
            <div class="help" *ngIf="hasError('email','duplicate')">This email already exists</div>
          </div>

          <!-- Phone -->
          <div class="field-wrap">
            <label class="label">Phone <span class="req">*</span></label>
            <input class="input" type="text" formControlName="phone" placeholder="Enter phone (10 digits)" />
            <div class="help" *ngIf="hasError('phone','required')">Phone number is required</div>
            <div class="help" *ngIf="hasError('phone','pattern')">Enter a valid phone number</div>
            <div class="help" *ngIf="hasError('phone','duplicate')">This phone number already exists</div>
          </div>

          <!-- Status -->
          <div class="field-wrap">
            <label class="label">Status <span class="req">*</span></label>
            <select class="select" formControlName="status">
              <option *ngFor="let s of statuses" [value]="s">{{ s }}</option>
            </select>
            <div class="help" *ngIf="hasError('status','required')">Status is required</div>
          </div>

          <!-- Role -->
          <div class="field-wrap">
            <label class="label">Role <span class="req">*</span></label>
            <select class="select" formControlName="roleName">
              <option *ngFor="let r of roleOptions" [value]="r.value">{{ r.label }}</option>
            </select>

            <!-- ✅ FIXED: roleName instead of role -->
            <div class="help" *ngIf="hasError('roleName','required')">Role is required</div>
          </div>

        </div>

        <!-- Actions -->
        <div class="um-actions">
          <button type="submit" class="btn secondary" [disabled]="isSubmitting">
            {{ isSubmitting ? 'Saving...' : 'Add User' }}
          </button>

          <button type="button" class="btn ghost" (click)="onCancel()">
            Cancel
          </button>
        </div>

      </form>
    </section>
  </main>

  <!-- ✅ Success Popup -->
  <div *ngIf="showSuccess"
       style="position: fixed; inset: 0; z-index: 1000; display: grid; place-items: center;"
       [attr.aria-hidden]="!showSuccess"
       (click)="closeSuccess()">

    <div style="position:absolute; inset:0; background: rgba(17,17,17,.38); backdrop-filter: blur(2px);"></div>

    <div style="position: relative; width: min(520px, 92vw); background: #ffffff; border-radius: 16px;
                border: 1px solid rgba(16, 50, 74, 0.14); box-shadow: 0 18px 50px rgba(17,17,17,.25);
                padding: 32px 20px 20px; text-align: center;"
         role="dialog" aria-modal="true" aria-label="User added successfully"
         (click)="$event.stopPropagation()">

      <div style="position:absolute; left:50%; top:0; transform: translate(-50%, -50%); width: 78px; height:78px;
                  border-radius: 999px; background: #34C759; display:grid; place-items:center;
                  box-shadow: 0 6px 18px rgba(52,199,89,.45), 0 0 0 6px rgba(52,199,89,.15);" aria-hidden="true">
        <svg width="38" height="38" viewBox="0 0 24 24">
          <path d="M20 6L9 17l-5-5" fill="none" stroke="#fff" stroke-width="2.6"
                stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>

      <h3 style="margin: 28px 0 6px; font-size: 1.35rem; color:#10324A; letter-spacing:.2px;">
        Thank You!
      </h3>

      <p style="margin:0 0 18px; color:#515151;">
        {{ successMessage || 'User added successfully.' }}
      </p>

      <div style="display:flex; justify-content:center;">
        <button type="button" (click)="closeSuccess()"
                style="border:0; cursor:pointer; padding:12px 18px; border-radius: 12px; background:#34C759;
                       color:#fff; font-weight:800; letter-spacing:.2px; min-width: 120px;
                       box-shadow: 0 8px 20px rgba(52,199,89,.35);">
          OK
        </button>
      </div>

    </div>
  </div>

</div>