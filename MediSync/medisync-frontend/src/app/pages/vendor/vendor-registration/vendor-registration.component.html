<div class="page-wrapper">
  <div class="band">
    <header role="banner">
      <div class="container">
        <nav class="nav" aria-label="Primary navigation">
          <div class="brand">
            <div class="mark"></div>
            <div class="brand-title">
              <strong>MediSync</strong>
              <small>Vendor onboarding</small>
            </div>
          </div>

          <div class="navlinks">
            <a routerLink="/">Home</a>
            <!-- ✅ correct login route -->
            <a routerLink="/auth/login">Log in</a>
          </div>
        </nav>
      </div>
    </header>

    <section class="hero">
      <div class="container">
        <div class="eyebrow"><span class="dot"></span> Vendor registration • Step-by-step</div>
        <h1>Register your business to access MediSync tenders.</h1>
        <p>Complete business profile, contact details, address, documents, and set your password.</p>
      </div>
    </section>
  </div>

  <main id="main">
    <div class="container">
      <div class="shell">
        <div class="toprow">
          
          <div class="crumbs">
            <a [routerLink]="['/']" aria-label="Go back">← Back to landing</a>
            <span>•</span>
            <span>Vendor Registration</span>
          </div>

          <div class="actions">
            <button class="btn ghost" type="button" (click)="restoreDraft()">Restore Draft</button>
            <button class="btn secondary" type="button" (click)="saveDraft()">Save as Draft</button>
          </div>
        </div>

        <div class="stepper">
          <div class="steps">
            <div
              class="step"
              *ngFor="let step of steps"
              [class.active]="step.index === currentStep"
              [class.done]="step.index < currentStep"
              (click)="setStep(step.index)"
            >
              <span class="n">{{ step.index + 1 }}</span> {{ step.label }}
            </div>
          </div>
          <div class="progress">
            <span [style.width]="progressPercentage"></span>
          </div>
        </div>

        <form [formGroup]="registrationForm" (ngSubmit)="submit()">
          <div class="body">

            <!-- STEP 1: BUSINESS -->
            <fieldset [class.active]="currentStep === 0" formGroupName="business">
              <legend>Business Details</legend>
              <p class="hint">Fields marked <span class="req">*</span> are required.</p>

              <div class="grid">
                <div>
                  <label>Business Name <span class="req">*</span></label>
                  <input type="text" formControlName="businessName"
                    [class.error-border]="businessGroup.get('businessName')?.invalid && businessGroup.get('businessName')?.touched" />
                  <div class="field-error" *ngIf="businessGroup.get('businessName')?.invalid && businessGroup.get('businessName')?.touched">
                    Name is required (2-80 chars).
                  </div>
                </div>

                <div>
                  <label>GST Number <span class="req">*</span></label>
                  <input type="text" formControlName="gstNumber" placeholder="e.g., 32ABCDE1234F1Z5" />
                  <div class="field-error" *ngIf="businessGroup.get('gstNumber')?.invalid && businessGroup.get('gstNumber')?.touched">
                    Valid GST Number is required.
                  </div>
                </div>

                <div>
                  <label>Business Type <span class="req">*</span></label>
                  <select formControlName="businessType">
                    <option value="">Select</option>
                    <option>Manufacturer</option>
                    <option>Distributor</option>
                    <option>Wholesaler</option>
                    <option>Retailer</option>
                    <option>Service Provider</option>
                  </select>
                  <div class="field-error" *ngIf="businessGroup.get('businessType')?.invalid && businessGroup.get('businessType')?.touched">
                    Please select a type.
                  </div>
                </div>

                <div>
                  <label>Year of Establishment <span class="req">*</span></label>
                  <input type="number" formControlName="yearOfEstablishment" placeholder="e.g., 2012" />
                  <div class="field-error" *ngIf="businessGroup.get('yearOfEstablishment')?.invalid && businessGroup.get('yearOfEstablishment')?.touched">
                    Valid year (1800-2099) required.
                  </div>
                </div>

                <!-- ✅ backend requires licenseNumber -->
                <div>
                  <label>License Number <span class="req">*</span></label>
                  <input type="text" formControlName="licenseNumber" placeholder="e.g., LIC-12345" />
                  <div class="field-error" *ngIf="businessGroup.get('licenseNumber')?.invalid && businessGroup.get('licenseNumber')?.touched">
                    License number is required.
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="actions">
                  <button class="btn primary" type="button" (click)="next()">Next →</button>
                </div>
              </div>
            </fieldset>

            <!-- STEP 2: CONTACT -->
            <fieldset [class.active]="currentStep === 1" formGroupName="contact">
              <legend>Contact Details</legend>

              <div class="grid">
                <div>
                  <label>Primary Email <span class="req">*</span></label>
                  <input type="email" formControlName="primaryEmail" placeholder="name@company.com" />
                  <div class="field-error" *ngIf="contactGroup.get('primaryEmail')?.invalid && contactGroup.get('primaryEmail')?.touched">
                    Valid email is required.
                  </div>
                </div>

                <div>
                  <label>Primary Phone <span class="req">*</span></label>
                  <input type="tel" formControlName="primaryPhone" placeholder="+91 9xxxx xxxxx" />
                  <div class="field-error" *ngIf="contactGroup.get('primaryPhone')?.invalid && contactGroup.get('primaryPhone')?.touched">
                    Valid phone number required.
                  </div>
                </div>

                <div>
                  <label>Alternate Phone</label>
                  <input type="tel" formControlName="alternatePhone" placeholder="Optional" />
                </div>
              </div>

              <div class="row">
                <div class="actions">
                  <button class="btn ghost" type="button" (click)="prev()">← Back</button>
                  <button class="btn primary" type="button" (click)="next()">Next →</button>
                </div>
              </div>
            </fieldset>

            <!-- STEP 3: ADDRESS -->
            <fieldset [class.active]="currentStep === 2" formGroupName="address">
              <legend>Address</legend>

              <div class="grid">
                <div>
                  <label>Address Line 1 <span class="req">*</span></label>
                  <input type="text" formControlName="address1" />
                  <div class="field-error" *ngIf="addressGroup.get('address1')?.invalid && addressGroup.get('address1')?.touched">
                    Address is required.
                  </div>
                </div>

                <div>
                  <label>Address Line 2</label>
                  <input type="text" formControlName="address2" />
                </div>

                <div>
                  <label>City <span class="req">*</span></label>
                  <input type="text" formControlName="city" />
                  <div class="field-error" *ngIf="addressGroup.get('city')?.invalid && addressGroup.get('city')?.touched">
                    City is required.
                  </div>
                </div>

                <div>
                  <label>State/UT <span class="req">*</span></label>
                  <select formControlName="state">
                    <option value="">Select</option>
                    <option>Andhra Pradesh</option>
                    <option>Kerala</option>
                    <option>Tamil Nadu</option>
                    <option>Karnataka</option>
                    <option>Maharashtra</option>
                    <option>Delhi</option>
                  </select>
                  <div class="field-error" *ngIf="addressGroup.get('state')?.invalid && addressGroup.get('state')?.touched">
                    State is required.
                  </div>
                </div>

                <div>
                  <label>PIN Code <span class="req">*</span></label>
                  <input type="text" formControlName="pin" placeholder="e.g., 695001" />
                  <div class="field-error" *ngIf="addressGroup.get('pin')?.invalid && addressGroup.get('pin')?.touched">
                    Valid 6-digit PIN required.
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="actions">
                  <button class="btn ghost" type="button" (click)="prev()">← Back</button>
                  <button class="btn primary" type="button" (click)="next()">Next →</button>
                </div>
              </div>
            </fieldset>

            <!-- STEP 4: DOCUMENTS + PASSWORD -->
            <fieldset [class.active]="currentStep === 3" formGroupName="documents">
              <legend>Upload Documents + Set Password</legend>

              <div class="grid">
                <div class="filebox">
                  <label>GST Certificate (PDF) <span class="req">*</span></label>
                  <input type="file" (change)="onFileSelected($event, 'docGst')" accept=".pdf" />
                  <div class="filename">{{ fileNames['docGst'] }}</div>

                  <div class="field-error" *ngIf="documentsGroup.get('docGst')?.errors?.['required'] && documentsGroup.get('docGst')?.touched">
                    File required.
                  </div>
                  <div class="field-error" *ngIf="documentsGroup.get('docGst')?.errors?.['invalidType']">Only PDF files allowed.</div>
                  <div class="field-error" *ngIf="documentsGroup.get('docGst')?.errors?.['invalidSize']">File too large (&gt;5MB).</div>
                </div>

                <div class="filebox">
                  <label>PAN (PDF) <span class="req">*</span></label>
                  <input type="file" (change)="onFileSelected($event, 'docPan')" accept=".pdf" />
                  <div class="filename">{{ fileNames['docPan'] }}</div>

                  <div class="field-error" *ngIf="documentsGroup.get('docPan')?.errors?.['required'] && documentsGroup.get('docPan')?.touched">
                    File required.
                  </div>
                  <div class="field-error" *ngIf="documentsGroup.get('docPan')?.errors?.['invalidType']">Only PDF files allowed.</div>
                  <div class="field-error" *ngIf="documentsGroup.get('docPan')?.errors?.['invalidSize']">File too large (&gt;5MB).</div>
                </div>

                <div class="filebox" style="grid-column: 1 / -1;">
                  <label>Business License (PDF) <span class="req">*</span></label>
                  <input type="file" (change)="onFileSelected($event, 'docLicense')" accept=".pdf" />
                  <div class="filename">{{ fileNames['docLicense'] }}</div>

                  <div class="field-error" *ngIf="documentsGroup.get('docLicense')?.errors?.['required'] && documentsGroup.get('docLicense')?.touched">
                    File required.
                  </div>
                  <div class="field-error" *ngIf="documentsGroup.get('docLicense')?.errors?.['invalidType']">Only PDF files allowed.</div>
                  <div class="field-error" *ngIf="documentsGroup.get('docLicense')?.errors?.['invalidSize']">File too large (&gt;5MB).</div>
                </div>

                <!-- ✅ password fields -->
                <div>
                  <label>Password <span class="req">*</span></label>
                  <input type="password" formControlName="password" placeholder="Min 8 chars, include Aa1@" />
                  <div class="field-error" *ngIf="documentsGroup.get('password')?.touched && documentsGroup.get('password')?.invalid">
                    Password must be at least 8 chars and include uppercase, lowercase, number, and special character.
                  </div>
                </div>

                <div>
                  <label>Confirm Password <span class="req">*</span></label>
                  <input type="password" formControlName="confirmPassword" placeholder="Re-enter password" />
                  <div class="field-error" *ngIf="documentsGroup.get('confirmPassword')?.touched && documentsGroup.get('confirmPassword')?.invalid">
                    Confirm password is required.
                  </div>
                  <div class="field-error" *ngIf="documentsGroup.touched && documentsGroup.errors?.['passwordMismatch']">
                    Passwords do not match.
                  </div>
                </div>
              </div>

              <div class="check" style="margin-top:14px;">
                <input type="checkbox" formControlName="confirmAccurate" />
                <p>I confirm that the details provided are accurate. <span class="req">*</span></p>
              </div>

              <div class="field-error" *ngIf="documentsGroup.get('confirmAccurate')?.invalid && documentsGroup.get('confirmAccurate')?.touched">
                You must confirm accuracy.
              </div>

              <div class="row">
                <div class="actions">
                  <button class="btn ghost" type="button" (click)="prev()">← Back</button>
                  <button class="btn secondary" type="submit" [disabled]="submitting">
                    {{ submitting ? 'Registering...' : 'Register' }}
                  </button>
                  <button class="btn ghost" type="button" (click)="resetForm()">Cancel</button>
                </div>
              </div>
            </fieldset>

          </div>
        </form>
      </div>
    </div>
  </main>

  <div class="toast" *ngIf="toastMessage">
    <strong>{{ toastMessage.title }}</strong>
    <small>{{ toastMessage.msg }}</small>
  </div>
</div>
