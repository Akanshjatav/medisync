<section class="container page-head">
  <div class="head-row">
    <div class="branch" aria-live="polite">
      Branch: <span id="branchName">{{ branchName }}</span>
    </div>

    <div class="tools" role="group" aria-label="Inventory tools">
      <input
        class="input"
        id="searchInput"
        type="search"
        placeholder="Search medicine name…"
        aria-label="Search medicine name"
        [(ngModel)]="searchTerm"
        (input)="onSearchChange()"
      />

      <select
        class="select"
        id="sortSelect"
        aria-label="Sort"
        [(ngModel)]="sortVal"
        (change)="onSortChange()"
      >
        <option value="expiryAsc">Expiry Date ↑</option>
        <option value="expiryDesc">Expiry Date ↓</option>
        <option value="qtyAsc">Stock ↑</option>
        <option value="qtyDesc">Stock ↓</option>
        <option value="nameAsc">Name A–Z</option>
        <option value="nameDesc">Name Z–A</option>
      </select>

    </div>
  </div>
</section>

<div class="card" id="inventoryCard" aria-busy="false">
  <div class="card-header">
    <span>Drug Expiring within 3 Months</span>
    <span id="statusText" class="loading">{{ statusText }}</span>
  </div>

  <div id="tableWrap">
    <div class="empty" *ngIf="rows.length === 0">
      No drugs expiring within 3 months for the current filters.
    </div>

    <table class="inventory-table" *ngIf="rows.length > 0">
      <thead>
        <tr>
          <th style="width:72px;">S. No</th>
          <th>Medicine</th>
          <th style="width:160px; text-align:right;">Stock</th>
          <th style="width:140px;">Unit</th>
          <th style="width:140px;">Expiry Date</th>
          <th style="width:140px;">Days Left</th>
        </tr>
      </thead>

      <tbody>
        <tr
          *ngFor="let r of rows; trackBy: trackBySNo"
          [attr.data-severity]="r.severity"
          [class.sev-expired]="r.severity === 'expired'"
          [class.sev-urgent]="r.severity === 'urgent'"
          [class.sev-soon]="r.severity === 'soon'"
        >
          <td>{{ r.sNo }}</td>
          <td>{{ r.medicine }}</td>
          <td style="text-align:right; font-weight:700;">{{ r.stock | number }}</td>
          <td>{{ r.unit }}</td>
          <td>{{ r.expiryDate }}</td>
          <td>{{ r.daysLeftText }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>