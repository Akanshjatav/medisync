<dialog #dlg aria-label="Change Password">
  <form (ngSubmit)="onSubmit()" method="dialog" novalidate>
    <div class="dialog-head">
      <div>
        <h3 style="margin:0; color:var(--navy);">Change Password</h3>
        <p class="muted" style="margin:6px 0 0;">Strong password rules + server submit (recommended).</p>
      </div>
      <button type="button" class="dialog-close" (click)="close()" aria-label="Close" title="Close">âœ•</button>
    </div>

    <div style="padding:14px;">
      <div class="form-grid">
        <!-- Current password -->
        <div class="field span-2">
          <label for="pw0">Current password <span class="req">*</span></label>
          <div class="pw-row">
            <input id="pw0" [(ngModel)]="pw0" name="pw0" required maxlength="64" autocomplete="current-password" />
            <button type="button" class="btn ghost tiny" (click)="toggle('pw0')">{{ pw0Shown ? 'Hide' : 'Show' }}</button>
          </div>
          <small class="muted">Enter your existing password.</small>
          <small class="err" aria-live="polite">{{ err0 }}</small>
        </div>

        <!-- New password -->
        <div class="field">
          <label for="pw1">New password <span class="req">*</span></label>
          <div class="pw-row">
            <input id="pw1" [(ngModel)]="pw1" name="pw1" required minlength="12" maxlength="64" autocomplete="new-password" />
            <button type="button" class="btn ghost tiny" (click)="toggle('pw1')">{{ pw1Shown ? 'Hide' : 'Show' }}</button>
          </div>

          <div class="meter" aria-hidden="true">
            <div class="meter-bar" [style.width.%]="score" [style.background]="score >= 80 ? '#22c55e' : score >= 55 ? '#f59e0b' : '#ef4444'"></div>
          </div>

          <small class="muted">Use 12+ characters and a mix of upper/lowercase, numbers, and symbols.</small>
          <small class="err" aria-live="polite">{{ err1 }}</small>
        </div>

        <!-- Confirm -->
        <div class="field">
          <label for="pw2">Confirm password <span class="req">*</span></label>
          <div class="pw-row">
            <input id="pw2" [(ngModel)]="pw2" name="pw2" required minlength="12" maxlength="64" autocomplete="new-password" />
            <button type="button" class="btn ghost tiny" (click)="toggle('pw2')">{{ pw2Shown ? 'Hide' : 'Show' }}</button>
          </div>
          <small class="muted">Re-type the new password.</small>
          <small class="err" aria-live="polite">{{ err2 }}</small>
        </div>
      </div>

      <div class="row">
        <button class="btn ghost" type="button" (click)="close()">Cancel</button>
        <button class="btn secondary" type="submit">Update</button>
      </div>
    </div>
  </form>
</dialog>